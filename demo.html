<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>JSON Editor Example</title>

    <!-- placeholders for the theme switcher -->
    <link rel='stylesheet' id='theme_stylesheet'>
    <link rel='stylesheet' id='icon_stylesheet'>

    <style>
        [class*="foundicon-"] {
            font-family: GeneralFoundicons;
            font-style: normal;
        }
    </style>
    <script src="auto-complete.min.js"></script>
    <link rel="stylesheet" href="auto-complete.css">
    <script src='dist/jsoneditor.js'></script>
    <style>
        /* ------BEGIN------ */
        /* VERTICAL CHILD IM PROPS LAYOUT */
  
        .related-im-props-container .json-editor-btn-add,
        .related-im-props-container .json-editor-btn-delete {
            display: none;
        }      
          
        .related-im-props-container .content,
        .related-im-props-container h3 {
            display: none;
        }
        
        .related-im-props-container div {
            opacity: 1!important;
        }
        
        .related-im-props-container span
        {
            color: -webkit-link;
            text-decoration: underline;
            cursor: pointer;
        }
        
        .related-im-props-container .form-control
        {
            display: none;
            
        }

        
        /* -------END------- */
        
        
        /* ------BEGIN------ */
        /* FIXING TAB LAYOUT */

        .vertical-tab-container .tabs {
            float: none!important;
            width: auto!important;
            clear: both;
            padding: 5px;
        }
        
        .vertical-tab-container .tabs > div {
            float: left;
            padding: 2px;
            border: solid rgb(221, 221, 221);
            border-width: 1px 1px 0px 1px;
            border-radius: 3px;
        }
        
        .vertical-tab-container .content {
            clear: both!important;
            float: none!important;
            margin-left: 0px!important;
        }
        /* -------END------- */
        /* FIXING TAB LAYOUT */
        
        .improp-root-element {
            width: 90%;
            max-width: 800px;
            min-width: 260px;
        }
        
        #editor_holder > div> h3 {
            font-family: Tahoma, Arial, 'MS Sans Serif';
            font-weight: bold;
            font-size: 9pt;
            color: #144489;
            vertical-align: bottom;
            border-bottom-color: #2763A5;
            border-style: solid;
            border-width: 0px 0px 5px 0px;
        }
        
        .improp-root-element label {
            float: left;
            clear: left;
            min-width: 190px;
            font-family: Tahoma, Arial, 'MS Sans Serif';
            font-size: 10.6667px;
            font-style: normal;
            font-variant: normal;
            font-weight: normal!important;
        }
        
        .improp-root-element .form-control {
            clear: both;
            min-height: 20px;
            padding: 2px;
        }
        
        .improp-root-element select {
            width: 180px;
        }
        
        .improp-root-element input {
            width: 176px;
            padding: 1px;
            border-width: 2px;
        }
        
        .layout-block-title {
            font-size: 12px;
            color: rgb(0, 0, 128);
            display: table-cell;
            font-family: Tahoma, Arial, 'MS Sans Serif';
            font-size: 10.6667px;
            font-style: normal;
            font-variant: normal;
            font-weight: bold;
        }
    </style>

    <script>
        /**
     * LZString compression library
     * Used to create direct links to the demo.
     * NOT REQUIRED for JSON Editor.
     * https://github.com/pieroxy/lz-string
     */
    var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(e){if(e==null)return"";var t="";var n,r,i,s,o,u,a;var f=0;e=LZString.compress(e);while(f<e.length*2){if(f%2==0){n=e.charCodeAt(f/2)>>8;r=e.charCodeAt(f/2)&255;if(f/2+1<e.length)i=e.charCodeAt(f/2+1)>>8;else i=NaN}else{n=e.charCodeAt((f-1)/2)&255;if((f+1)/2<e.length){r=e.charCodeAt((f+1)/2)>>8;i=e.charCodeAt((f+1)/2)&255}else r=i=NaN}f+=3;s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+LZString._keyStr.charAt(s)+LZString._keyStr.charAt(o)+LZString._keyStr.charAt(u)+LZString._keyStr.charAt(a)}return t},decompressFromBase64:function(e){if(e==null)return"";var t="",n=0,r,i,s,o,u,a,f,l,c=0,h=LZString._f;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(c<e.length){u=LZString._keyStr.indexOf(e.charAt(c++));a=LZString._keyStr.indexOf(e.charAt(c++));f=LZString._keyStr.indexOf(e.charAt(c++));l=LZString._keyStr.indexOf(e.charAt(c++));i=u<<2|a>>4;s=(a&15)<<4|f>>2;o=(f&3)<<6|l;if(n%2==0){r=i<<8;if(f!=64){t+=h(r|s)}if(l!=64){r=o<<8}}else{t=t+h(r|i);if(f!=64){r=s<<8}if(l!=64){t+=h(r|o)}}n+=3}return LZString.decompress(t)},compressToUTF16:function(e){if(e==null)return"";var t="",n,r,i,s=0,o=LZString._f;e=LZString.compress(e);for(n=0;n<e.length;n++){r=e.charCodeAt(n);switch(s++){case 0:t+=o((r>>1)+32);i=(r&1)<<14;break;case 1:t+=o(i+(r>>2)+32);i=(r&3)<<13;break;case 2:t+=o(i+(r>>3)+32);i=(r&7)<<12;break;case 3:t+=o(i+(r>>4)+32);i=(r&15)<<11;break;case 4:t+=o(i+(r>>5)+32);i=(r&31)<<10;break;case 5:t+=o(i+(r>>6)+32);i=(r&63)<<9;break;case 6:t+=o(i+(r>>7)+32);i=(r&127)<<8;break;case 7:t+=o(i+(r>>8)+32);i=(r&255)<<7;break;case 8:t+=o(i+(r>>9)+32);i=(r&511)<<6;break;case 9:t+=o(i+(r>>10)+32);i=(r&1023)<<5;break;case 10:t+=o(i+(r>>11)+32);i=(r&2047)<<4;break;case 11:t+=o(i+(r>>12)+32);i=(r&4095)<<3;break;case 12:t+=o(i+(r>>13)+32);i=(r&8191)<<2;break;case 13:t+=o(i+(r>>14)+32);i=(r&16383)<<1;break;case 14:t+=o(i+(r>>15)+32,(r&32767)+32);s=0;break}}return t+o(i+32)},decompressFromUTF16:function(e){if(e==null)return"";var t="",n,r,i=0,s=0,o=LZString._f;while(s<e.length){r=e.charCodeAt(s)-32;switch(i++){case 0:n=r<<1;break;case 1:t+=o(n|r>>14);n=(r&16383)<<2;break;case 2:t+=o(n|r>>13);n=(r&8191)<<3;break;case 3:t+=o(n|r>>12);n=(r&4095)<<4;break;case 4:t+=o(n|r>>11);n=(r&2047)<<5;break;case 5:t+=o(n|r>>10);n=(r&1023)<<6;break;case 6:t+=o(n|r>>9);n=(r&511)<<7;break;case 7:t+=o(n|r>>8);n=(r&255)<<8;break;case 8:t+=o(n|r>>7);n=(r&127)<<9;break;case 9:t+=o(n|r>>6);n=(r&63)<<10;break;case 10:t+=o(n|r>>5);n=(r&31)<<11;break;case 11:t+=o(n|r>>4);n=(r&15)<<12;break;case 12:t+=o(n|r>>3);n=(r&7)<<13;break;case 13:t+=o(n|r>>2);n=(r&3)<<14;break;case 14:t+=o(n|r>>1);n=(r&1)<<15;break;case 15:t+=o(n|r);i=0;break}s++}return LZString.decompress(t)},compressToUint8Array:function(e){var t=LZString.compress(e);var n=new Uint8Array(t.length*2);for(var r=0,i=t.length;r<i;r++){var s=t.charCodeAt(r);n[r*2]=s>>>8;n[r*2+1]=s%256}return n},decompressFromUint8Array:function(e){if(e===null||e===undefined){return LZString.decompress(e)}else{var t=new Array(e.length/2);for(var n=0,r=t.length;n<r;n++){t[n]=e[n*2]*256+e[n*2+1]}return LZString.decompress(String.fromCharCode.apply(null,t))}},compressToEncodedURIComponent:function(e){return LZString.compressToBase64(e).replace(/=/g,"$").replace(/\//g,"-")},decompressFromEncodedURIComponent:function(e){if(e)e=e.replace(/$/g,"=").replace(/-/g,"/");return LZString.decompressFromBase64(e)},compress:function(e){if(e==null)return"";var t,n,r={},i={},s="",o="",u="",a=2,f=3,l=2,c="",h=0,p=0,d,v=LZString._f;for(d=0;d<e.length;d+=1){s=e.charAt(d);if(!Object.prototype.hasOwnProperty.call(r,s)){r[s]=f++;i[s]=true}o=u+s;if(Object.prototype.hasOwnProperty.call(r,o)){u=o}else{if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}r[o]=f++;u=String(s)}}if(u!==""){if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}}n=2;for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}while(true){h=h<<1;if(p==15){c+=v(h);break}else p++}return c},decompress:function(e){if(e==null)return"";if(e=="")return null;var t=[],n,r=4,i=4,s=3,o="",u="",a,f,l,c,h,p,d,v=LZString._f,m={string:e,val:e.charCodeAt(0),position:32768,index:1};for(a=0;a<3;a+=1){t[a]=a}l=0;h=Math.pow(2,2);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(n=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 2:return""}t[3]=d;f=u=d;while(true){if(m.index>m.string.length){return""}l=0;h=Math.pow(2,s);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(d=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 2:return u}if(r==0){r=Math.pow(2,s);s++}if(t[d]){o=t[d]}else{if(d===i){o=f+f.charAt(0)}else{return null}}u+=o;t[i++]=f+o.charAt(0);r--;f=o;if(r==0){r=Math.pow(2,s);s++}}}};if(typeof module!=="undefined"&&module!=null){module.exports=LZString}
    </script>
</head>

<body>
    <div class='container'>
        <div class='row'>
            <div class='span8 col-md-8 columns eight large-8'>
                <h2>Editor</h2>
                <p>Below is the editor generated from the JSON Schema.</p>

                <div id='editor_holder'></div>
            </div>
            <div class='span4 col-md-4 columns four large-4'>
                <div>
                    <a href='#' id='direct_link'>Direct Link</a> (preserves schema, value, and options)
                </div>

                <h2>JSON Output</h2>
                <p>You can also make changes to the JSON here and set the value in the editor by clicking
                    <button class='btn btn-primary' id='setvalue'>Update Form</button>
                </p>
                <textarea id='output' style='width: 100%; height: 300px; font-family: monospace;' class='form-control'></textarea>

                <h2>Options</h2>
                <div id='options_holder'>
                    <div>
                        <label>CSS Framework</label>
                        <select id='theme_switcher' class='form-control'>
                            <option value='barebones'>Barebones</option>
                            <option value='html'>HTML</option>
                            <option value='jqueryui'>jQuery UI</option>
                            <option value='bootstrap2'>Bootstrap 2</option>
                            <option value='bootstrap3'>Bootstrap 3</option>
                            <option value='foundation3'>Foundation 3</option>
                            <option value='foundation4'>Foundation 4</option>
                            <option value='foundation5'>Foundation 5</option>
                            <option value='foundation6'>Foundation 6</option>
                        </select>
                    </div>
                    <div>
                        <label>Icon Library</label>
                        <select id='icon_switcher' class='form-control'>
                            <option value=''>None</option>
                            <option value='jqueryui'>jQuery UI</option>
                            <option value='bootstrap2'>Bootstrap 2 Glyphicons</option>
                            <option value='bootstrap3'>Bootstrap 3 Glyphicons</option>
                            <option value='foundation2'>Foundicons 2</option>
                            <option value='foundation3'>Foundicons 3</option>
                            <option value='fontawesome3'>FontAwesome 3</option>
                            <option value='fontawesome4'>FontAwesome 4</option>
                        </select>
                    </div>
                    <div>
                        <label>Object Layout</label>
                        <select id='object_layout' class='form-control'>
                            <option value='normal'>normal</option>
                            <option value='grid'>grid</option>
                        </select>
                    </div>
                    <div>
                        <label>Show Errors</label>
                        <select id='show_errors' class='form-control'>
                            <option value='interaction'>On Interaction</option>
                            <option value='change'>On Field Change</option>
                            <option value='always'>Always</option>
                            <option value='never'>Never</option>
                        </select>
                    </div>
                    <div>
                        <label>Boolean options</label>
                        <select multiple size=9 id='boolean_options' style='width: 100%;' class='form-control'>
                            <option value='required_by_default'>Object properties required by default</option>
                            <option value='no_additional_properties'>No additional object properties</option>
                            <option value='ajax'>Allow loading schemas via Ajax</option>
                            <option value='disable_edit_json'>Disable "Edit JSON" buttons</option>
                            <option value='disable_collapse'>Disable collapse buttons</option>
                            <option value='disable_properties'>Disable properties buttons</option>
                            <option value='disable_array_add'>Disable array add buttons</option>
                            <option value='disable_array_reorder'>Disable array move buttons</option>
                            <option value='disable_array_delete'>Disable array delete buttons</option>
                            <option value='disable_array_delete_all_rows'>Disable array delete all rows buttons</option>
                            <option value='disable_array_delete_last_row'>Disable array delete last row buttons</option>
                        </select>
                    </div>
                </div>

                <h2>Validation</h2>
                <textarea id='validate' style='width: 100%; height: 100px; font-family: monospace;' readonly disabled class='form-control'></textarea>
            </div>
            <div class='row'>
                <div class='span12 col-md-12 columns twelve large-12'>
                    <h2>Schema</h2>
                    <button class='btn btn-primary' id='setschema'>Update Schema</button>
                    </p>

                    <textarea id='schema' style='width: 100%; height: 450px; font-family: monospace;' class='form-control'></textarea>
                </div>
            </div>
            <div class='row'>
                <div class='span12 col-md-12 columns twelve large-12'>
                    <h2>Layout Schema</h2>
                    <button class='btn btn-primary' id='setlayout_schema'>Update Layout Schema</button>
                    </p>

                    <textarea id='layout_schema' style='width: 100%; height: 450px; font-family: monospace;' class='form-control'></textarea>
                </div>
            </div>
        </div>
    </div>
    <script>
        (function() {
    var schema;
    var layout_schema;
    if(window.location.href.match('[?&]schema=([^&]+)')) {
        try {
            schema = JSON.parse(LZString.decompressFromBase64(window.location.href.match('[?&]schema=([^&]+)')[1]));
        }
        catch(e) {
            console.log('invalid starting schema');
        }
    }
    JSONEditor.defaults.options.upload = function (type, file, cbs) {
        if (type === 'root.upload_fail') cbs.failure('Upload failed');
        else {
            var tick = 0;

            var tickFunction = function () {
                tick += 1;
                console.log('progress: ' + tick);

                if (tick < 100) {
                    cbs.updateProgress(tick);
                    window.setTimeout(tickFunction, 50)
                } else if (tick == 100) {
                    cbs.updateProgress();
                    window.setTimeout(tickFunction, 500)
                } else {
                    cbs.success('http://www.example.com/images/' + file.name);
                }
            };
            window.setTimeout(tickFunction)
        }
    };
    JSONEditor.defaults.options.disable_edit_json = true;
    JSONEditor.defaults.options.disable_properties = true;
    JSONEditor.defaults.options.disable_collapse = true;
    if(!layout_schema){
        layout_schema = {
                "groups": [
                  {
                      "Id": "LeftTopGroup",                              
                      "Fields": [
                        {
                            "Path": "root.location.location_nested"
                        },
                        {
                            "Path": "root.master_prop_fund.mpf_name"
                        },
                        {
                            "Path": "root.im_cat_id"
                        },
                        {
                            "Path": "root.master_prop_fund.mpf_registered_no"
                        },                        
                        {
                            "Path": "root.master_prop_fund.mpf_risk_id"
                        },
                        {
                            "Path": "root.master_prop_fund.mpf_dd_id"
                        }
                      ]
                  },
                  {
                      "Id": "LeftMiddleGroup",
                      "Fields": [
                        {
                            "Path": "root.master_prop_fund.mpf_reg_address"
                        },
                        {
                            "Path": "root.master_prop_fund.mpf_reg_city"
                        },
                        {
                            "Path": "root.master_prop_fund.mpf_reg_state"
                        },
                        {
                            "Path": "root.master_prop_fund.mpf_reg_postcode"
                        },
                        {
                            "Path": "root.master_prop_fund.mpf_reg_country"
                        }
                      ]
                  },
                  {
                      "Id": "LeftBottomGroup",
                      "Fields": [
                        {
                            "Path": "root.master_prop_fund.mpf_biz_address"
                        },
                        {
                            "Path": "root.master_prop_fund.mpf_biz_city"
                        },
                        {
                            "Path": "root.master_prop_fund.mpf_biz_state"
                        },
                        {
                            "Path": "root.master_prop_fund.mpf_biz_postcode"
                        },
                        {
                            "Path": "root.master_prop_fund.mpf_biz_country"
                        }
                      ]
                  },
                  {
                      "Id": "RightTopGroup",
                      "Fields": [
                        {
                            "Path": "root.location"
                        },
                        {
                            "Path": "root.master_prop_fund.mpf_directors"
                        },
                        {
                            "Path": "root.master_prop_fund.mpf_isopen"
                        },
                        {
                            "Path": "root.master_prop_fund.mpf_open_date"
                        },
                        {
                            "Path": "root.master_prop_fund.mpf_close_date"
                        },
                        {
                            "Path": "root.master_prop_fund.regulatory_body_id"
                        },
                        {
                            "Path": "root.im_prop_assets"
                        },
                        {
                            "Path": "root.im_prop_regulator_no"
                        }
                      ]
                  },
                  {
                      "Id": "RightBottomGroup",
                      "Fields": [
                        {
                            "Path": "root.im_prop_oasys.im_oasys_account"
                        },
                        {
                            "Path": "root.im_prop_oasys.im_oasys_block"
                        },
                        {
                            "Path": "root.im_prop_oasys.im_oasys_gacronym"
                        },
                        {
                            "Path": "root.im_prop_oasys.im_oasys_dacronym"
                        },
                        {
                            "Path": "root._im_cc_bda"
                        },
                        {
                            "Path": "root._im_cc_usa"
                        }
                      ]
                  },
                  {
                      "Id": "Tab1Group",
                      "Fields": [
                            {
                                "Path": "root.documents"
                            }
                      ]
                  },
                  {
                      "Id": "Tab2Group",
                      "Fields": [
                            {
                                "Path": "root.notes"
                            }
                      ]
                  },
                  {
                      "Id": "Tab3Group",
                      "Fields": [
                            {
                                "Path": "root.mpf_people25"
                            }
                      ]
                  },
                  {
                      "Id": "Tab4Group",
                      "Fields": [
                            {
                                "Path": "root.mpf_companies25"
                            }
                      ]
                  },
                  {
                      "Id": "RelatedImPropsTabGroup",                      
                      "Fields": [
                            {
                                "Path": "root.relatedIMProps"
                            }
                      ]
                  }                                                                                                 
                ],
                "layout": [
                  {
                      type: "container",
                      cssClass: "improp-root-element",                      
                    //   "attributes": [
                    //     {
                    //         "name": "class",
                    //         "value": "improp-root-element"
                    //     }
                    //   ],
                       "childBlocks": [
                    //     {
                    //         type: "group",
                    //         "cssClass": [
                    //             "related-im-props-container",
                    //             "vertical-tab-container",
                    //         ],
                    //         "RefId": "RelatedImPropsTabGroup"
                    //     },
                    //     {
                    //         type: "separator"
                    //     },
                        {
                            type: "container",
                            "attributes": [
                                {
                                    "name": "style",
                                    "value": "float: left;"
                                }
                            ],
                            "childBlocks": [                                
                                {
                                    type: "group",
                                    "RefId": "LeftTopGroup"
                                },
                                {
                                    type: "separator"
                                },
                                {
                                    type: "group",
                                    title: "Registered Address:",
                                    "RefId": "LeftMiddleGroup"
                                },
                                {
                                    type: "separator"
                                },
                                {
                                    type: "group",
                                    title: "Business Address:",
                                    "RefId": "LeftBottomGroup"
                                }
                            ]
                        },
                        {
                            type: "container",
                            "attributes": [
                                {
                                    "name": "style",
                                    "value": "float: left;"
                                }
                            ],
                            "childBlocks": [
                                {
                                    type: "group",
                                    "RefId": "RightTopGroup"
                                },
                                {
                                    type: "separator"
                                },
                                {
                                    type: "group",
                                    title: "Oasys Global Details",
                                    "RefId": "RightBottomGroup"
                                }
                            ]
                        },
                        {
                            type: "separator"
                        },
                        {
                            type: "tab_container",
                            cssClass: "vertical-tab-container",
                            "childBlocks": [
                                {
                                    type: "tab",
                                    title: "Documents",                                    
                                    "RefId": "Tab1Group"
                                },
                                {
                                    type: "tab",
                                    title: "Notes",
                                    "RefId": "Tab2Group"
                                },
                                {
                                    type: "tab",
                                    title: "Control over 25% (People)",
                                    "RefId": "Tab3Group"
                                },
                                {
                                    type: "tab",
                                    title: "Control over 25% (Companies)",
                                    "RefId": "Tab4Group"
                                },
                                {
                                    type: "tab",
                                    title: "Related IM Props",
                                    "cssClass": [
                                        "related-im-props-container"
                                    ],
                                    "RefId": "RelatedImPropsTabGroup"
                                }                                
                            ]                            
                        }
                      ]
                  }
                ]
            };
    }
    // Default starting schema
    if(!schema) {
        schema = {
                     $ref: "#/definitions/im_prop"
                ,
                definitions: {
                    im_prop: {
                        title: "IM PROP",
                        type: "object",
                        properties: {     
                            // relatedIMProps: {
                            //     "type": "array",   
                            //     "format": "tabs",
                            //     title: "Related IM Props",                       
                            //     "items": {
                            //         headerTemplate:"{{self.name}}",     
                            //         "type": "object",
                            //         "properties": {
                            //             "name": {
                            //                 "type": "string"
                            //             }
                            //         }
                            //     }
                            // },   
                            relatedIMProps: {
                                "type": "array",   
                               // "format": "tabs",
                                title: "Related IM Props",                       
                                "items": {
                                    //headerTemplate:"{{self.name}}",     
                                    "type": "object", 
                                    "id": "related_im_prop_item",                                   
                                    "properties": {
                                        "name": {
                                            "type": "string",
                                            "watch": {
                                                "link_id": "related_im_prop_item.id",
                                                "link_title": "related_im_prop_item.name",
                                            },
                                            // headerTemplate:"{{link_title}}",
                                            "links": [
                                                {
                                                    "href": "/test/path/{{link_id}}",
                                                    "rel": "{{link_title}}"                     
                                                }
                                            ]
                                        },
                                        "id": {
                                            "type": "string"
                                        }
                                    }
                                }
                            },                 
                            mpf_companies25: {
                                "type": "array",     
                                title: "Control over 25% (Companies)",                   
                                "uniqueItems": true,
                                "items": {
                                    $ref: "#/definitions/master_prop_fund"
                                }
                            },
                            mpf_people25: {
                                "type": "array",     
                                title: "Control over 25% (People)",                   
                                "uniqueItems": true,
                                "items": {
                                    $ref: "#/definitions/mpf_people25"
                                }
                            },
                            "documents": {
                                type: "array",
                                //format: "table",
                                title: "Documents",
                                uniqueItems: true,
                                items: {
                                    $ref: "#/definitions/document"                            
                                }
                            },
                            "notes": {
                                type: "array",
                                // format: "table",
                                title: "Notes",
                                uniqueItems: true,
                                items: {
                                    $ref: "#/definitions/note"       
                                }
                            },                                        
                            "im_cat_id": {
                                type: "string",
                                title: "Category",
                                "enum": [
                                    "Other",
                                    "Hedge Fund",
                                    "Fund Manager",
                                    "Bank Proprietary Trading Desk",
                                    "Hedge Fund – Prop Trading",
                                    "Broker",
                                    "Hedge Fund - Research Only",
                                    "Mutual Fund",
                                    "US Broker Dealer",
                                    "Govt Entity"
                                ],
                                "default": "undefined"
                            },                                        
                            "im_prop_assets": {
                                type: "string",
                                title: "Assets Under Management",
                                "enum": [
                                    "Not Disclosed",
                                    "Less than 100 M",
                                    "More than 100 M",
                                    "Less than 50 M"
                                ],
                                "default": "undefined"
                            },
                            "im_prop_regulator_no": {
                                type: "integer",
                                title: "Regulator number",
                                minimum: 10000,
                                maximum: 99999999
                            },                    
                            "_im_cc_bda": {
                                type: "boolean",
                                format: "checkbox",
                                title: "CC BDA"
                            },
                            "_im_cc_usa": {
                                type: "boolean",
                                format: "checkbox",
                                title: "CC USA"
                            },
                            master_prop_fund: {
                                $ref: "#/definitions/master_prop_fund",
                                title: "Company 25"
                            },
                            im_prop_oasys: {
                                $ref: "#/definitions/im_prop_oasys"
                            }   
                        }
                    },
                    // IS NOT USED IN THIS SCHEME, but is used for fund_administrator
                    fund_administrator: {
                        "type": "object",
                        "properties": {
                            "fund_admin_firstname": {
                                type: "string",
                                title: "Name "
                            },   
                            "fund_admin_surname": {
                                type: "string",
                                title: "Surname"
                            },
                            "fund_admin_address": {
                                type: "string",
                                title: "Address"
                            },
                            "fund_admin_city": {
                                type: "string",
                                title: "City"
                            },                         
                            "fund_admin_state": {
                                type: "string",
                                title: "State"
                            },
                            "fund_admin_postcode": {
                                type: "string",
                                title: "Post Code/ZIP"
                            },
                            "fund_admin_country": {
                                type: "string",
                                title: "Country"
                            }
                        }
                    },
                    im_prop_oasys: {
                        "type": "object",
                        "properties": {
                            "im_oasys_account": {
                                type: "string",
                                title: "Account"
                            },
                            "im_oasys_block": {
                                type: "string",
                                title: "Oasis block?",
                                "enum": [
                                    "Block",
                                    "Allocation"
                                ],
                                "default": "undefined"
                            },
                            "im_oasys_gacronym": {
                                type: "string",
                                title: "Global Acronym"
                            },
                            "im_oasys_dacronym": {
                                type: "string",
                                title: "Domestic Acronym"
                            }
                        }
                    },
                    master_prop_fund: {
                        "type": "object",
                        "title": "Master Fund",
                        "properties": {
                            "mpf_name": {
                                type: "string",
                                title: "IM PROP Name"
                            },
                            "mpf_risk_id": {
                                type: "string",
                                title: "Risk",
                                "enum": [
                                    "Low",
                                    "Medium",
                                    "High"
                                ],
                                "default": "undefined"
                            },
                            "mpf_dd_id": {
                                type: "string",
                                title: "Due Diligence",
                                "enum": [
                                    "Simplified due diligence",
                                    "Customer due diligence",
                                    "Enhanced due diligence"
                                ],
                                "default": "undefined"
                            },
        
                            /* Registered Address:*/
                            "mpf_reg_address": {
                                type: "string",
                                title: "Address"
                            },
                            "mpf_reg_city": {
                                type: "string",
                                title: "City"
                            },
                            "mpf_reg_state": {
                                type: "string",
                                title: "State"
                            },
                            "mpf_reg_postcode": {
                                type: "string",
                                title: "Post Code/ZIP"
                            },
                            "mpf_reg_country": {
                                type: "string",
                                title: "Country"
                            },
        
                            /* Business Address: */
                            "mpf_biz_address": {
                                type: "string",
                                title: "Address"
                            },
                            "mpf_biz_city": {
                                type: "string",
                                title: "City"
                            },
                            "mpf_biz_state": {
                                type: "string",
                                title: "State"
                            },
                            "mpf_biz_postcode": {
                                type: "string",
                                title: "Post Code/ZIP"
                            },
                            "mpf_biz_country": {
                                type: "string",
                                title: "Country"
                            },
                            "mpf_registered_no": {
                                type: "string",
                                title: "Registered number"
                            },
                            "regulatory_body_id": {
                                type: "string",
                                format: "autocomplete",
                                title: "Regulatory Body",
                                options: {
                                        choises: [
                                            "USAPATRIOT ACT|USAPATRIOT ACT",
                                            "TWSE|Taiwan Stock Exchange Corp",
                                            "SICCFIN|SERVICE D'INFORMATION ET DE CONTROLE SUR LES CIRCUITES FINANCIERS",
                                            "SFC|Securities and Futures Commission",
                                            "SECOM MALAYSIA|Securities Commission Malaysia",
                                            "SEC|SECURITIES AND EXCHANGE COMMISSION",
                                            "SCB|The Securities Commission of The Bahamas",
                                            "SAAM|SWISS ASSOCIATION OF ASSET MANAGERS",
                                            "PHLX|Philadelphia Stock Exchange",
                                            "PFTS|PFTS Stock Exchange, Ukraine",
                                            "OSFI|Office of the Superintendent of Financial Institutions Canada",
                                            "OSFI|Office of the Superintendent of Financial Institutions Canada",
                                            "OSC|ONTARIO SECURITIES COMMISION",
                                            "OARG|ORGANISME D'AUTOREGULATION",
                                            "NZFSP|New Zealand Financial Services Provider Register",
                                            "NFA|NATIONAL FUTURES ASSOCIATION",
                                            "MFSA|Malta Financial Services Authority",
                                            "MAS|MONETARY AUTHORITY OF SINGAPORE",
                                            "LISTED|Listed on regulated exchange",
                                            "JFSC|Jersey Financial Services Commission",
                                            "IOM FSC|Isle of Man Financial Supervision Commission",
                                            "INAF|Institut Nacional Andorra De Finances",
                                            "IFS|IRISH FINANCIAL SERVICES REGULATOR",
                                            "HCMC|Hellenic Capital Market Commission",
                                            "GOVERNMENT|GOVT PENSION FUND",
                                            "GFSC|Guernsey Financial Services Commission",
                                            "Finansinspektionen|Swedish Financial Supervisory Authority",
                                            "Financial Supervisory Service of Korea|Financial Supervisory Service of Korea",
                                            "FSS Korea|Financial Supervisory Service of Korea",
                                            "FSCM|Financial Services Commission of Mauritius",
                                            "FSCB|Financial Supervision Commission of Bulgaria",
                                            "FSC|Financial Services Commission of Gibraltar",
                                            "FSB|Financial Services Board South Africa",
                                            "FSAN|The Financial Supervisory Authority of Norway",
                                            "FSAJP|Financial Services Agency Japan",
                                            "FMSA|Financial Market Stabilisation Agency",
                                            "FMA|Financial Market Authority Liechtenstein",
                                            "FINRA|FINANCIAL INDUSTRY REGULATORY AUTHORITY",
                                            "FINMA|Swiss Financial Market Supervisory Authority",
                                            "FCA|FINANCIAL CONDUCT AUTHORITY",
                                            "Danish FSA|Finanstilsynet",
                                            "CSSF|Commission de Surveillance du Secteur Financier - Luxembourg",
                                            "CSEC|Cyprus Securities and Exchange Commission",
                                            "CSA|Canadian Securities Administrators",
                                            "CNMV|Comisión Nacional del Mercado de Valores",
                                            "CIMA|Cayman Islands Monetary Authority",
                                            "CCAF|Commission de Controle des Activities Financiers",
                                            "CBOE|CHICAGO BOARD OPTIONS EXCHANGE",
                                            "CBIE|Central Bank of Ireland",
                                            "BVIFSC|British Virgin Islands Financial Services Commission",
                                            "BOS|BANK OF SLOVENIA",
                                            "BMA|Bermuda Monetary Authority",
                                            "BI|BANK D\'ITALIA",
                                            "BF|Banque de France",
                                            "BDP|Banco De Portugal",
                                            "BDE|Banco De Espana",
                                            "BAFIN|German Federal Financial Supervisory Authority",
                                            "ATVP|Securities Market Agency Slovenia",
                                            "ATVP|Securities Market Agency Slovenia",
                                            "ASIC|AUSTRALIAN SECURITIES & INVESTMENTS COMMISSION",
                                            "AMF|AUTORITE DES MARCHES FINANCIERS",
                                            "AFM|Netherlands Authority For the Financial Markets"
                                        ]
                                }
                            },
                            "mpf_directors": {
                                type: "string",
                                title: "Directors",
                                format: "textarea",
                                "options": {
                                    "input_height": "50px"
                                }
                            },
                            "mpf_isopen": {
                                type: "boolean",
                                format: "checkbox",
                                title: "Is Open?"
                            },
                            "mpf_open_date": {
                                type: "string",
                                format: "date",
                                title: "Open date:"
                            },
                            "mpf_close_date": {
                                type: "string",
                                format: "date",
                                title: "Close date:"
                            }                            
                        },
                    },
                    mpf_people25: {
                        "type": "object",
                        "title": "People 25",
                        "properties": {
                            "mpf_people25_firstname": {
                                "title": "Firstname",
                                "type": "string" 
                            },
                            "mpf_people25_surname": {
                                "title": "Surname",
                                "type": "string" 
                            },
                            "mpf_people25_dob": {
                                "title": "DOB",
                                "type": "string",
                                format: "date"
                            },
                            "mpf_people25_address": {
                                "title": "Address",
                                "type": "string" 
                            },
                            "mpf_people25_city": {
                                "title": "City",
                                "type": "string" 
                            },
                            "mpf_people25_state": {
                                "title": "State",
                                "type": "string" 
                            },
                            "mpf_people25_postcode": {
                                "title": "Oist Code/ZIP",
                                "type": "string" 
                            },
                            "mpf_people25_country": {
                                "title": "Country",
                                "type": "string" 
                            },
                            "mpf_people25_passport": {
                                "title": "Passport Expity Date",
                                "type": "string",
                                format: "date"
                            }
                        }
                    },
                    document: {
                            type: "object",
                            title: "Document",
                            properties: {
                                "Name": {
                                    type: "string"
                                },
                                "upload": {
                                    title:"Upload document",
                                    type: "string",
                                    format: "url",
                                    options: {
                                        upload: true
                                    },
                                    "links": [
                                      {
                                          "href": "{{self}}"
                                      }
                                    ]
                                },
                                "Category": {
                                    type: "autocomplete",
                                    options: {
                                        choises: [
                                            "SSI",
                                            "Trading Authorization",
                                            "Incorporation",
                                            "Misc",
                                            "Regulation",
                                            "Tax",
                                            "Fund",
                                            "AML",
                                            "Financials",
                                            "SIA 151",
                                            "KYC",
                                            "Options",
                                            "MIFID",
                                            "Compliance Alert",
                                            "Comm Share Agreement",
                                            "EGUS",
                                            "Terms Of Business",
                                            "Fund Admin",
                                            "CDD",
                                            "Inv Mgmt Agreement",
                                            "Passport",
                                            "F1SA",
                                            "Prospectus",
                                            "CDC,OFAC,PEP",
                                            "Audited Financials",
                                            "Residential Address",
                                            "Contacts",
                                            "Mem and Arts",
                                            "Directors",
                                            "Name Change",
                                            "Auth Signatories",
                                            "ID Confirmation",
                                            "OATS",
                                            "Proof of Address",
                                            "COMFORT LETTER",
                                            "Driving Licence",
                                            "Softdollar Agreement",
                                            "W-8BEN-E",
                                            "Foreign Bank Certification",
                                            "Assets Under Mgmt"
                                        ]
                                    }
                                }
                            }
                        },
                        note: {
                            type: "object",
                            title: "Notes",
                            properties: {
                                "mpf_note_comments": {
                                    title: "Comment",
                                    format: "textarea",
                                    type: "string",
                                    "options": {
                                        "input_height": "80px"
                                    }
                                },
                                "mpf_note_date": {
                                    title: "Date",
                                    type: "string",
                                    format: "date"
                                },
                                /*JSON HAS FIELD FOR AUTHOR: authorId (http://json-schema.org/latest/json-schema-hypermedia.html) */
                                "mpf_note_uid": {
                                    title: "Author",
                                    type: "string"
                                }
                            }
                        }
                }
            }
    }

    // Divs/textareas on the page
    var $schema = document.getElementById('schema');
    var $layout_schema = document.getElementById('layout_schema');
    var $output = document.getElementById('output');
    var $editor = document.getElementById('editor_holder');
    var $validate = document.getElementById('validate');

    // Buttons
    var $set_schema_button = document.getElementById('setschema');
    var $set_layout_schema_button = document.getElementById('setlayout_schema');
    var $set_value_button = document.getElementById('setvalue');

    var jsoneditor;

    var updateDirectLink = function() {
        var url = window.location.href.replace(/\?.*/,'');

        url += '?schema='+LZString.compressToBase64(JSON.stringify(schema));
        url += '&value='+LZString.compressToBase64(JSON.stringify(jsoneditor.getValue()));

        for(var i in JSONEditor.defaults.options) {
            if(!JSONEditor.defaults.options.hasOwnProperty(i)) continue;
            if(JSONEditor.defaults.options[i]===false) continue;
            else if(JSONEditor.defaults.options[i]===true) {
                url += '&'+i;
            }
            else {
                url += '&'+i+'='+JSONEditor.defaults.options[i];
            }
        }

        document.getElementById('direct_link').href = url;
    };

    var reload = function(keep_value) {
        var startval = (jsoneditor && keep_value)? jsoneditor.getValue() : window.startval;
        window.startval = undefined;

        if(jsoneditor) jsoneditor.destroy();
        jsoneditor = new JSONEditor($editor,{
            schema: schema,
            layout_schema: layout_schema, 
            startval: startval,
            show_errors: "always"
        });
        window.jsoneditor = jsoneditor;

        // When the value of the editor changes, update the JSON output and validation message
        jsoneditor.on('change',function() {
            var json = jsoneditor.getValue();

            $output.value = JSON.stringify(json,null,2);

            var validation_errors = jsoneditor.validate();
            // Show validation errors if there are any
            if(validation_errors.length) {
                $validate.value = JSON.stringify(validation_errors,null,2);
            }
            else {
                $validate.value = 'valid';
            }

            updateDirectLink();
        });
    };

    // Start the schema and output textareas with initial values
    $schema.value = JSON.stringify(schema,null,2);
    $layout_schema.value = JSON.stringify(layout_schema,null,2);
    $output.value = '';

    // When the 'update form' button is clicked, set the editor's value
    $set_value_button.addEventListener('click',function() {
        jsoneditor.setValue(JSON.parse($output.value));
    });

    // Update the schema when the button is clicked
    $set_schema_button.addEventListener('click',function() {
        try {
            schema = JSON.parse($schema.value);
        }
        catch(e) {
            alert('Invalid Schema: '+e.message);
            return;
        }

        reload();
    });
    
    $set_layout_schema_button.addEventListener('click',function() {
        try {
            layout_schema = JSON.parse($layout_schema.value);
        }
        catch(e) {
            alert('Invalid Schema: '+e.message);
            return;
        }

        reload();
    });
    
    // Set the theme by loading the right stylesheets
    var setTheme = function(theme,no_reload) {
        theme = theme || '';

        var mapping = {
            barebones: '',
            html: '',
            bootstrap2: 'http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css',
            bootstrap3: 'http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css',
            foundation3: 'http://cdnjs.cloudflare.com/ajax/libs/foundation/3.2.5/stylesheets/foundation.css',
            foundation4: 'http://cdn.jsdelivr.net/foundation/4.3.2/css/foundation.min.css',
            foundation5: 'http://cdn.jsdelivr.net/foundation/5.0.2/css/foundation.min.css',
            foundation6: 'http://cdn.jsdelivr.net/foundation/6.2.1/foundation.min.css',
            jqueryui: 'http://code.jquery.com/ui/1.10.3/themes/south-street/jquery-ui.css'
        };

        if(typeof mapping[theme] === 'undefined') {
            theme = 'html';
            document.getElementById('theme_switcher').value = theme;
        }

        JSONEditor.defaults.options.theme = theme;

        document.getElementById('theme_stylesheet').href = mapping[theme];
        document.getElementById('theme_switcher').value = JSONEditor.defaults.options.theme;

        if(!no_reload) reload(true);
    };

    // Set the icontheme
    // Set the theme by loading the right stylesheets
    var setIconlib = function(iconlib,no_reload) {
        iconlib = iconlib || '';
        var mapping = {
            foundation2: 'http://cdnjs.cloudflare.com/ajax/libs/foundicons/2.0/stylesheets/general_foundicons.css',
            foundation3: 'http://cdnjs.cloudflare.com/ajax/libs/foundicons/3.0.0/foundation-icons.css',
            fontawesome3: 'http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.css',
            fontawesome4: 'http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.css'
        };

        JSONEditor.defaults.options.iconlib = iconlib;

        document.getElementById('icon_stylesheet').href = mapping[iconlib] || '';
        document.getElementById('icon_switcher').value = JSONEditor.defaults.options.iconlib;

        if(!no_reload) reload(true);
    };

    var refreshBooleanOptions = function(no_reload) {
        return;
        var boolean_options = document.getElementById('boolean_options').children;
        for(var i=0; i<boolean_options.length; i++) {
            JSONEditor.defaults.options[boolean_options[i].value] = boolean_options[i].selected;
        }
        if(!no_reload) reload(true);
    };

    // Change listeners for options
    document.getElementById('theme_switcher').addEventListener('change',function() {
        setTheme(this.value);
    });
    document.getElementById('icon_switcher').addEventListener('change',function() {
        setIconlib(this.value);
    });
    document.getElementById('object_layout').addEventListener('change',function() {
       JSONEditor.defaults.options.object_layout = this.value;
        reload(true);
    });
    document.getElementById('show_errors').addEventListener('change',function() {
       JSONEditor.defaults.options.show_errors = this.value;
        reload(true);
    });
    document.getElementById('boolean_options').addEventListener('change',function() {
        refreshBooleanOptions();
    });

    // Get starting value from url
    if(window.location.href.match('[?&]value=([^&]+)')) {
      window.startval = JSON.parse(LZString.decompressFromBase64(window.location.href.match('[?&]value=([^&]+)')[1]));
    }

    // Set options from direct link
    setTheme((window.location.href.match(/[?&]theme=([^&]+)/)||[])[1] || 'html', true);

    setIconlib((window.location.href.match(/[?&]iconlib=([^&]*)/)||[null,'fontawesome4'])[1], true);

    document.getElementById('object_layout').value = (window.location.href.match(/[?&]object_layout=([^&]+)/)||[])[1] || 'normal';
    JSONEditor.defaults.options.object_layout = document.getElementById('object_layout').value;

    document.getElementById('show_errors').value = (window.location.href.match(/[?&]show_errors=([^&]+)/)||[])[1] || 'interaction';
    JSONEditor.defaults.options.show_errors = document.getElementById('show_errors').value;

    var boolean_options = document.getElementById('boolean_options').children;
    for(var i=0; i<boolean_options.length; i++) {
        if(window.location.href.match(new RegExp('[?&]'+boolean_options[i].getAttribute('value')+'([&=]|$)'))) {
            boolean_options[i].selected = true;
        }
    }
    refreshBooleanOptions(true);

    reload();
})();
    </script>
</body>

</html>